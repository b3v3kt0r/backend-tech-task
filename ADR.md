# Рішення: SQL
## Контекст 
Необхідність обрати базу даних для збереження подій.
## Варіанти 
- Варіант SQL: добре підходить для структурованих даних, підтримує складні запити та агрегації.
- Варіант NoSQL: гнучкий у схемі, добре для напівструктурованих або великих обсягів даних без суворої структури.
## Рішення 
Обрав SQL, оскільки події мають чітку структуру і потрібні зручні запити та агрегації.


# Рішення: Celery/Redis
## Контекст 
Необхідність організувати асинхронну обробку подій через чергу та бекграунд воркера.
## Варіанти 
- Варіант Redis: простий у налаштуванні, швидкий, добре підходить для структурованих задач.
- Варіант RebitMQ: більш гнучкий і надійний для складних сценаріїв маршрутизації та гарантії доставки.
## Рішення 
Обрав Celery + Redis, оскільки це популярний стек, який добре інтегрується з FastAPI, і я вже мав досвід його використання.


# Рішення: Rate limiting/SlowAPI
## Контекст 
Необхідність обмежити кількість запитів до API на одного користувача чи IP, щоб захистити сервер від надмірного навантаження.
## Варіанти 
- Варіант slowapi: простий у налаштуванні, дозволяє лімітувати по IP або користувачеві, легко інтегрується з FastAPI.
- Варіант власної реалізації: складніше підтримувати, треба реалізовувати кешування та ліміти вручну.
## Рішення 
Обрав slowapi, бо це готове рішення для FastAPI, дозволяє швидко додати ліміти запитів, має просту інтеграцію з IP або токенами користувачів, і добре підходить для нашого API.


# Рішення: DuckDB
## Контекст 
Необхідність зберігати історичні події та проводити аналітику над великими обсягами даних, при цьому не навантажуючи основну базу даних.
## Варіанти 
- Варіант DuckDB: підтримує стовпчикову організацію, швидкі агрегати, SQL-запити, підтримує JSON.
- Варіант ClickHouse: стовпчикові формати, добре підходять для аналітики, але інтеграція може бути складнішою, потребує окремого воркера або конвеєра ETL.
## Рішення 
Обрав Обрав DuckDB, бо легко інтегрувати з Python/Celery, періодично синхронізуючи дані з PostgreSQL, підтримує стовпчикову організацію і швидкі аналітичні запити (DAU, top-events, retention), Не потребує додаткового серверу, все працює як embedded база, що зручно для холодного шару.